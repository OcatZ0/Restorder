<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --oxford-blue: #32434d;
        --oracle: #3e737b;
        --moon-mist: #d4d5bf;
        --sage: #929b80;
        --nandor: #4f5951;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      body {
        background: linear-gradient(
          135deg,
          var(--oxford-blue) 0%,
          var(--nandor) 100%
        );
        min-height: 100vh;
      }

      .login-card {
        animation: fadeInUp 0.8s ease-out;
        background-color: rgba(255, 255, 255, 0.95) !important;
      }

      .logo-img {
        animation: float 3s ease-in-out infinite;
        max-width: 150px;
      }

      .btn-login {
        background-color: var(--oracle) !important;
        border-color: var(--oracle) !important;
        transition: all 0.3s ease;
      }

      .btn-login:hover {
        background-color: var(--oxford-blue) !important;
        border-color: var(--oxford-blue) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .form-control:focus {
        border-color: var(--sage) !important;
        box-shadow: 0 0 0 0.25rem rgba(146, 155, 128, 0.25) !important;
      }

      .input-wrapper {
        animation: fadeInUp 0.8s ease-out;
        animation-delay: 0.2s;
        animation-fill-mode: both;
      }
    </style>
  </head>
  <body>
    <div
      class="container d-flex justify-content-center align-items-center min-vh-100"
    >
      <div class="row w-100 justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-5 col-xl-4">
          <div class="card shadow-lg border-0 rounded-4 login-card">
            <div class="card-body p-5">
              <div class="text-center mb-4">
                <img
                  src="{{ url_for('static', filename='assets/restorder.png') }}"
                  alt="Logo"
                  class="logo-img mb-3"
                />
                <h3 class="fw-bold" style="color: var(--oxford-blue)">
                  Selamat Datang Kembali
                </h3>
                <p class="text-muted">Silahkan masuk ke akun Anda</p>
              </div>

              <div class="input-wrapper">
                <div class="mb-3">
                  <label
                    for="username"
                    class="form-label fw-semibold"
                    style="color: var(--nandor)"
                    >Username</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-lg rounded-3"
                    id="username"
                    placeholder="Masukkan username Anda"
                  />
                </div>

                <div class="mb-4">
                  <label
                    for="password"
                    class="form-label fw-semibold"
                    style="color: var(--nandor)"
                    >Password</label
                  >
                  <input
                    type="password"
                    class="form-control form-control-lg rounded-3"
                    id="password"
                    placeholder="Masukkan password Anda"
                  />
                </div>

                <div class="d-grid mb-3">
                  <button
                    type="submit"
                    class="btn btn-lg btn-primary rounded-3 fw-semibold btn-login"
                  >
                    Login
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector(".login-card");
        const loginBtn = document.querySelector(".btn-login");

        loginBtn.addEventListener("click", async function (e) {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          // Basic validation
          if (!username || !password) {
            showErrorToast("Isi username dan password");
            return;
          }

          // Disable button and show loading state
          loginBtn.disabled = true;
          loginBtn.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';

          try {
            const response = await fetch("/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: username,
                password: password,
              }),
            });

            const data = await response.json();

            if (response.ok && data.success) {
              // Success - redirect or show success message
              showSuccessToast(data.message || "Login berhasil");
              loginBtn.classList.remove("btn-primary");
              loginBtn.classList.add("btn-success");

              // Redirect after short delay
              setTimeout(() => {
                window.location.href = data.redirect || "/order";
              }, 1000);
            } else {
              // Failed login
              throw new Error(data.message || "Login failed");
            }
          } catch (error) {
            // Show error message
            showErrorToast(error.message || "An error occurred during login");

            // Reset button
            loginBtn.disabled = false;
            loginBtn.innerHTML = "Login";
          }
        });

        // Allow Enter key to submit
        document
          .getElementById("password")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              loginBtn.click();
            }
          });
      });

      // Show toast notification
      function showErrorToast(message) {
        // Simple toast notification
        const toast = document.createElement("div");
        toast.className = "position-fixed bottom-0 end-0 p-3";
        toast.style.zIndex = "11";
        toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-body bg-danger text-white rounded">
                        <i class="bi bi-check-circle"></i> ${message}
                    </div>
                </div>
            `;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 3000);
      }
      function showSuccessToast(message) {
        // Simple toast notification
        const toast = document.createElement("div");
        toast.className = "position-fixed bottom-0 end-0 p-3";
        toast.style.zIndex = "11";
        toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-body bg-success text-white rounded">
                        <i class="bi bi-check-circle"></i> ${message}
                    </div>
                </div>
            `;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 3000);
      }
    </script>
  </body>
</html>
